@using System.Collections.Immutable
@using MyLittleContentEngine.Services.Content.TableOfContents

@if (TableOfContents != null)
{
    <nav>
        @{
            var childlessTocEntries = TableOfContents.Where(i => i.Items.Length == 0).ToList();
        }
        @if (childlessTocEntries.Count > 0)
        {
            <ul>
                @foreach (var tableOfContentEntry in childlessTocEntries.OrderBy(i => i.Order))
                {
                    @RootTocLink(tableOfContentEntry)
                }
            </ul>
        }

        @foreach (var tableOfContentEntry in TableOfContents.Where(i => i.Items.Length > 0).OrderBy(i => i.Order))
        {
            @if (string.IsNullOrWhiteSpace(tableOfContentEntry.Href))
            {
                <h4 class="@SectionHeaderStructureClass @SectionHeaderColorClass">@tableOfContentEntry.Name</h4>
            }
            else
            {
                <h4 class="@SectionHeaderStructureClass @SectionHeaderColorClass"><a href="@tableOfContentEntry.Href">@tableOfContentEntry.Name</a></h4>
            }

            <ul>
                @foreach (var childEntries in tableOfContentEntry.Items.OrderBy(i => i.Order))
                {
                    @TocLink(childEntries)
                }
            </ul>
        }
    </nav>
}

@code {
    [Parameter] public ImmutableList<TableOfContentEntry>? TableOfContents { get; set; }
    [Parameter] public string SectionHeaderStructureClass { get; set; } = "font-display font-medium pt-6 pb-4 first:pt-0";
    [Parameter] public string SectionHeaderColorClass { get; set; } = "text-base-900 dark:text-base-50";
    [Parameter] public string LinkStructureClass { get; set; } = "block text-sm w-full border-l pl-3.5 py-1.5";
    [Parameter] public string LinkColorClass { get; set; } = "border-base-700 aria-current:border-primary-400 text-base-700 dark:text-base-400 aria-current:text-primary-800 dark:aria-current:text-primary-500 hover:text-accent-400 dark:hover:text-base-50";
    [Parameter] public string RootLinkStructureClass { get; set; } = "block w-full py-1";
    [Parameter] public string RootLinkColorClass { get; set; } = "text-base-700 dark:text-base-400 aria-current:text-primary-800 dark:aria-current:text-primary-500 hover:text-accent-400 dark:hover:text-base-50";

    
    private RenderFragment TocLink(TableOfContentEntry tocEntry) =>
        @<li class="block">
            <a aria-current="@tocEntry.IsSelected.ToString().ToLowerInvariant()" href="@tocEntry.Href" class="@LinkStructureClass @LinkColorClass">@tocEntry.Name</a>
        </li>;
    
    private RenderFragment RootTocLink(TableOfContentEntry tocEntry) =>
        @<li class="block">
            <a aria-current="@tocEntry.IsSelected.ToString().ToLowerInvariant()" href="@tocEntry.Href" class="@RootLinkStructureClass @RootLinkColorClass">@tocEntry.Name</a>
        </li>;
}